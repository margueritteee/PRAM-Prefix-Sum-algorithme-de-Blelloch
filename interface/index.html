<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prefix Sum Calculator - CPGC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="main-container">
        <!-- Header Section -->
        <div class="header-card">
            <h1>üå∏ Prefix Sum Calculator üå∏</h1>
            <p class="description">
                Calculez la somme pr√©fixe d'un tableau en utilisant l'algorithme parall√®le de Blelloch.
                <br>
                Le processus se d√©roule en deux phases principales :
            </p>
            <div class="steps">
                <div class="step">
                    <span class="step-icon">‚¨ÜÔ∏è</span>
                    <span>Up-Sweep (Somme Parall√®le)</span>
                </div>
                <div class="step">
                    <span class="step-icon">‚¨áÔ∏è</span>
                    <span>Down-Sweep (Calcul Pr√©fixe)</span>
                </div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="input-card">
            <form method="post">
                <div class="input-group-custom">
                    <input 
                        type="text" 
                        class="custom-input" 
                        name="numbers"
                        placeholder="Entrez des nombres s√©par√©s par des virgules (ex: -1, 3, 7, -5, 3, 17, 8, 21)"
                        value="{{ input_numbers }}">
                    <button type="submit" class="calculate-btn">‚ú® Calculer ‚ú®</button>
                </div>
            </form>
        </div>

        <!-- Error Message Section -->
        {% if error_message %}
        <div class="result-card" style="border: 2px solid #ff6b6b; background: #ffe0e0;">
            <div class="section-title" style="color: #d32f2f;">
                <span class="section-icon">‚ö†Ô∏è</span>
                <span>{{ error_message }}</span>
            </div>
        </div>
        {% endif %}

        <!-- Complexity Analysis Section -->
        {% if complexity %}
        <div class="result-card complexity-card">
            <div class="section-title">
                <span class="section-icon">üìä</span>
                <span>Analyse de Complexit√©</span>
            </div>
            <div class="complexity-grid">
                <!-- Section Temps -->
                <div class="complexity-section">
                    <div class="complexity-header">‚è±Ô∏è Complexit√© en Temps</div>
                    <div class="complexity-metrics">
                        <div class="metric-item">
                            <span class="metric-label">Temps d'ex√©cution :</span>
                            <span class="metric-value">{{ "%.3f"|format(complexity.temps_execution_ms) }} ms</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Workers utilis√©s :</span>
                            <span class="metric-value">{{ complexity.nombre_workers }} c≈ìurs</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Profondeur arbre :</span>
                            <span class="metric-value">{{ complexity.profondeur_arbre }} niveaux</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Complexit√© :</span>
                            <span class="metric-value-formula">{{ complexity.complexite_temps }}</span>
                        </div>
                    </div>
                </div>

                <!-- Section Espace -->
                <div class="complexity-section">
                    <div class="complexity-header">üíæ Complexit√© en Espace</div>
                    <div class="complexity-metrics">
                        <div class="metric-item">
                            <span class="metric-label">M√©moire mesur√©e :</span>
                            <span class="metric-value">{{ complexity.memoire_mesuree_mb }} MB</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">√âl√©ments stock√©s :</span>
                            <span class="metric-value">{{ complexity.nombre_elements_stockes }}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Up-tree :</span>
                            <span class="metric-value-small">{{ complexity.elements_arbre_somme }} √©l√©ments</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Down-tree :</span>
                            <span class="metric-value-small">{{ complexity.elements_arbre_recon }} √©l√©ments</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Complexit√© :</span>
                            <span class="metric-value-formula">{{ complexity.complexite_espace }}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-label">Formule :</span>
                            <span class="metric-value-small">{{ complexity.formule_espace }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Up Tree Result (Arbre de Somme) -->
        {% if up_tree %}
        <div class="result-card">
            <div class="section-title">
                <span class="section-icon">‚¨ÜÔ∏è</span>
                <span>Phase 1 : Up-Sweep (Arbre de Somme Parall√®le)</span>
            </div>
            <p class="tree-description">Construction de l'arbre montant : chaque niveau additionne les paires d'√©l√©ments du niveau inf√©rieur.</p>
            <div class="tree-container">
                {% for level in up_tree|reverse %}
                    <div class="tree-level">
                        {% for node in level %}
                            <div class="tree-node up-node">{{ node }}</div>
                        {% endfor %}
                    </div>
                    {% if not loop.last %}
                        <div class="tree-connector up-connector">‚Üë</div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Down Tree Result (Arbre de Reconstruction) -->
        {% if down_tree %}
        <div class="result-card">
            <div class="section-title">
                <span class="section-icon">‚¨áÔ∏è</span>
                <span>Phase 2 : Down-Sweep (Arbre de Reconstruction)</span>
            </div>
            <p class="tree-description">Reconstruction descendante : √† partir de la racine, calcul de <strong>gauche = parent - droite</strong> √† chaque niveau.</p>
            <div class="tree-container">
                {% for level in down_tree %}
                    <div class="tree-level">
                        {% for node in level %}
                            <div class="tree-node down-node">{{ node }}</div>
                        {% endfor %}
                    </div>
                    {% if not loop.last %}
                        <div class="tree-connector">‚Üì</div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Final Result -->
        {% if S %}
        <div class="result-card final-card">
            <div class="section-title">
                <span class="section-icon">üéØ</span>
                <span>R√©sultat Final - Prefix Sum</span>
            </div>
            <div class="final-result">
                <div class="result-label">Somme Pr√©fixe :</div>
                <div class="result-values">{{ S }}</div>
            </div>
        </div>
        {% endif %}

        <!-- Explanation Card -->
        {% if S %}
        <div class="result-card explanation-card">
            <div class="section-title">
                <span class="section-icon">üí°</span>
                <span>Explication de l'Algorithme</span>
            </div>
            <div class="explanation-content">
                <div class="explanation-step">
                    <strong>1Ô∏è‚É£ Up-Sweep (Phase montante) :</strong>
                    <p>On construit un arbre binaire en additionnant les paires d'√©l√©ments √† chaque niveau jusqu'√† obtenir la somme totale √† la racine.</p>
                </div>
                <div class="explanation-step">
                    <strong>2Ô∏è‚É£ Down-Sweep (Phase descendante) :</strong>
                    <p>On part de la racine et on descend niveau par niveau. √Ä chaque n≈ìud, on applique : <code>gauche = parent - droite</code>.</p>
                </div>
                <div class="explanation-step">
                    <strong>3Ô∏è‚É£ R√©sultat :</strong>
                    <p>Le dernier niveau de l'arbre descendant contient la somme pr√©fixe compl√®te du tableau !</p>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <p>üíñ D√©velopp√© par Kezrane Margueritte üíñ</p>
            <p class="footer-subtitle">IAA ‚Ä¢ Module CPGC ‚Ä¢ Algorithme de Blelloch</p>
        </div>
    </div>
</body>
</html>